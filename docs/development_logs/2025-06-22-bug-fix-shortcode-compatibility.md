# [Hugo Shortcode 호환성 문제 해결]

- **날짜**: 2025-06-22
- **작성자**: Gunn.kim
- **관련 이슈**: 없음
- **이전 로그**: 없음

## 문제 상황
Notion에서 마이그레이션된 일부 포스트가 웹사이트에 정상적으로 표시되지 않는 문제가 발생했습니다. 로그 분석 결과, 증분 동기화나 캐시 문제가 아닌, Hugo에서 지원하지 않는 Shortcode(`{{< adsense >}}`, `{{< tweet >}}`, `{{< staticref >}}`)가 포함된 18개의 파일이 빌드 과정에서 제외되는 것이 원인이었습니다.

## 해결 전략
문제의 핵심 원인이 Shortcode 호환성에 있음을 파악하고, 두 가지 해결 옵션을 제시했습니다.
1.  **옵션 A: 전체 강제 재빌드**: `--full-sync` 옵션을 사용하여 캐시 문제를 완전히 배제하고, 문제가 순수하게 Shortcode에 의한 것인지 명확히 확인하는 방법입니다.
2.  **옵션 B: Shortcode 수정**: `scripts/fix-shortcodes.sh` 스크립트를 실행하여 호환되지 않는 Shortcode를 Hugo가 지원하는 형태로 일괄 변경하는 방법입니다.

**권장안**: 옵션 A를 먼저 시도하여 문제의 원인을 명확히 한 후, 옵션 B를 실행하여 근본적인 문제를 해결하는 것을 권장했습니다.

## 구현 세부사항
### 1. Shortcode 수정 스크립트 (`fix-shortcodes.sh`)
- `grep`과 `sed` 명령어를 사용하여 `content/posts/` 디렉토리 내의 모든 마크다운 파일을 대상으로 호환되지 않는 Shortcode를 찾아 수정합니다.
  - `{{< adsense >}}` -> `{{%/* adsense */%}}` (주석 처리)
  - `{{< tweet ... >}}` -> `{{< twitter ... >}}` (호환되는 Shortcode로 변경)
  - `{{< staticref ... >}}` -> `{{%/* staticref ... */%}}` (주석 처리하여 수동 검토 유도)

### 2. GitHub Actions 워크플로우 개선
- 빌드 과정에서 호환되지 않는 Shortcode가 유입되는 것을 방지하기 위해, 워크플로우에 **Shortcode 검증 단계**를 추가했습니다.
- 이 단계는 `grep`으로 문제의 Shortcode 수를 확인하고, 하나라도 발견되면 빌드를 실패 처리하여 오류를 조기에 감지합니다.
- 또한, 일주일 이상된 임시 오류 파일을 자동으로 삭제하는 **정기적 정리 작업**을 추가하여 시스템을 깨끗하게 유지하도록 했습니다.

## 기술적 고려사항
- **문제 진단**: "과거 포스트가 계속 노출된다"는 현상만으로는 원인을 파악하기 어려웠으나, 빌드 로그와 증분 동기화 로그를 면밀히 분석하여 실제 원인이 캐시가 아닌 Shortcode 호환성 문제임을 정확히 진단했습니다.
- **안전한 수정**: `staticref`와 같이 직접적인 대체가 어려운 Shortcode는 주석으로 처리하여, 사용자가 수동으로 검토하고 의도에 맞게 수정할 수 있도록 안전장치를 마련했습니다.

## 다음 단계
- `fix-shortcodes.sh` 스크립트를 실행하고, 변경사항을 커밋합니다.
- GitHub Actions 워크플로우를 실행하여 빌드가 정상적으로 완료되고, 이전에 제외되었던 18개의 포스트가 웹사이트에 올바르게 표시되는지 검증합니다.

## 참고 자료
- 없음
